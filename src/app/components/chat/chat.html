<div class="chat-page">
  <!-- Ã‰CRAN 1 : MOTEUR DE RECHERCHE -->
  <div class="search-hero" *ngIf="isSearchMode">
    <div class="search-card">
      <div class="logo">ğŸ›’ AI Shop Assistant</div>
      <h1>Que veux-tu acheter aujourdâ€™hui ?</h1>
      <p>Exemple : <strong>â€œbasket blanche taille 40, max 50â‚¬, livraison 3 joursâ€</strong></p>

      <form class="search-bar" (submit)="$event.preventDefault(); startFromSearch()">
        <input
          type="text"
          [(ngModel)]="searchQuery"
          name="searchQuery"
          (keydown)="handleKeydownSearch($event)"
          placeholder="DÃ©cris le produit que tu cherches..."
        />
        <button type="submit" [disabled]="!searchQuery.trim() || loading">Rechercher</button>
      </form>

      <div class="search-hints">
        <span>ğŸ‘Ÿ baskets</span>
        <span>ğŸ‘— robe soirÃ©e</span>
        <span>ğŸ§¥ manteau hiver</span>
        <span>ğŸ‘ chaussures ville</span>
      </div>
    </div>
  </div>

  <!-- Ã‰CRAN 2 : CHAT -->
  <div class="chat-container" *ngIf="!isSearchMode">
    <div class="chat-card">
      <!-- HEADER -->
      <header class="chat-header">
        <div class="chat-title">ğŸ›’ AI Shop Assistant</div>
        <div class="chat-subtitle">Dis-moi ce que tu veux, je te trouve les meilleures offres.</div>
      </header>

      <!-- CORPS -->
      <div class="chat-inner">
        <!-- MESSAGES -->
        <div class="chat-messages">
          <div *ngFor="let msg of messages" class="message-row" [ngClass]="msg.sender">
            <div class="avatar">
              <span *ngIf="msg.sender === 'user'">ğŸ§‘</span>
              <span *ngIf="msg.sender === 'ai'">ğŸ¤–</span>
            </div>

            <div class="bubble">
              <div class="text">
                {{ msg.text }}
              </div>

              <div class="products" *ngIf="msg.products?.length">
                <div class="product-card" *ngFor="let p of msg.products; let i = index">
                  <!-- Image produit -->
                  <div class="product-image">
                    <img [src]="p.img" [alt]="p.name" />
                  </div>

                  <!-- Ligne numÃ©ro + nom + prix -->
                  <div class="product-header">
                    <div class="product-index">
                      {{ i + 1 }}
                    </div>

                    <div class="product-info">
                      <div class="product-name">{{ p.name }}</div>
                      <div class="product-price">{{ p.price }} {{ p.currency }}</div>
                    </div>
                  </div>
                  <button type="button" class="product-buy">Acheter</button>

                  <!-- Bouton acheter -->
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="loading" class="message-row ai">
            <div class="avatar">ğŸ¤–</div>
            <div class="bubble">Recherche en cours...</div>
          </div>
        </div>

        <!-- INPUT CHAT -->
        <div class="chat-input-wrapper">
          <form class="chat-input" (submit)="$event.preventDefault(); sendMessage()">
            <textarea
              [(ngModel)]="userInput"
              name="userInput"
              placeholder='Affiner ta recherche, ex : "plutÃ´t Nike, livraison rapide"'
              (keydown)="handleKeydownChat($event)"
            ></textarea>
            <button type="submit" [disabled]="loading || !userInput.trim()">Envoyer</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
